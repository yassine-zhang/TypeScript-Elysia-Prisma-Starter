# ğŸš€ typescript-elysia-prisma-starter

è¿™æ˜¯ä¸€ä¸ªåŸºäº Bun + Elysia + Prisma çš„åç«¯é¡¹ç›®æ¡†æ¶ã€‚

***

## ğŸ“ ä¸»è¦ç›®å½•ç»“æ„

```markdown
.
â”œâ”€â”€ src/ # æºä»£ç ç›®å½•
â”‚ â”œâ”€â”€ bootstrap/ # å¯åŠ¨ç›¸å…³é…ç½®
â”‚ â”œâ”€â”€ controllers/ # æ§åˆ¶å™¨å±‚
â”‚ â”œâ”€â”€ emails/ # é‚®ä»¶æ¨¡æ¿
â”‚ â”œâ”€â”€ hooks/ # ä¸­é—´ä»¶é’©å­
â”‚ â”œâ”€â”€ models/ # æ•°æ®æ¨¡å‹å®šä¹‰
â”‚ â”œâ”€â”€ routes/ # è·¯ç”±å®šä¹‰
â”‚ â”œâ”€â”€ types/ # TypeScript ç±»å‹å®šä¹‰
â”‚ â””â”€â”€ utils/ # å·¥å…·å‡½æ•°
â”‚   â””â”€â”€ pay/ # æ”¯ä»˜ç›¸å…³å·¥å…·å‡½æ•°
â”‚       â””â”€â”€ ltzf/ # è“å…”æ”¯ä»˜æ¥å£å®ç°
â”‚           â”œâ”€â”€ sign.ts # ç­¾åéªŒè¯
â”‚           â”œâ”€â”€ notify.ts # æ”¯ä»˜é€šçŸ¥å¤„ç†
â”‚           â””â”€â”€ wx.ts # å¾®ä¿¡æ”¯ä»˜å®ç°
â”œâ”€â”€ prisma/ # Prisma ORM ç›¸å…³
â””â”€â”€ public/ # é™æ€èµ„æºç›®å½•
```

## âœ¨ æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

***

1. **è®¤è¯ç³»ç»Ÿ** ğŸ”

- JWT è®¤è¯å®ç° (`@elysiajs/jwt`)
- è·¯ç”±ç™½åå•æœºåˆ¶ (`auth-whitelist.ts`)
- éªŒè¯ç åŠŸèƒ½:
  - å›¾å½¢éªŒè¯ç  (`captcha.ts`)
  - é‚®ç®±éªŒè¯ç  (`emailCaptcha.ts`)

2. **æ•°æ®åº“é›†æˆ** ğŸ—„ï¸

- ä½¿ç”¨ Prisma ORM
- PostgreSQL æ•°æ®åº“æ”¯æŒ
- è‡ªåŠ¨æ—¶åŒºè®¾ç½®ä¸ºä¸Šæµ·æ—¶åŒº

3. **é‚®ä»¶ç³»ç»Ÿ** ğŸ“§

- åŸºäº ZeptoMail çš„é‚®ä»¶å‘é€
- HTML é‚®ä»¶æ¨¡æ¿æ”¯æŒ
- éªŒè¯ç é‚®ä»¶åŠŸèƒ½

4. **æ”¯ä»˜ç³»ç»Ÿ** ğŸ’¸

- è“å…”ä»˜æ¥å£é›†æˆ
- å¾®ä¿¡æ”¯ä»˜æ”¯æŒ
- æ”¯ä»˜é€šçŸ¥å¤„ç†
- ç­¾åéªŒè¯æœºåˆ¶

5. **API è·¯ç”±** ğŸ›£ï¸

- RESTful API è®¾è®¡
- è·¯ç”±å‰ç¼€ç®¡ç†
- ç»Ÿä¸€çš„é”™è¯¯å¤„ç†

6. **å¼€å‘å·¥å…·é“¾** ğŸ› ï¸

- Prettier ä»£ç æ ¼å¼åŒ–
- Husky Git hooks
- dotenvx ç¯å¢ƒå˜é‡ç®¡ç†
- TypeScript æ”¯æŒ

## ğŸ’¡ ç‰¹è‰²åŠŸèƒ½

***

1. **ç¯å¢ƒå˜é‡ç®¡ç†** âš™ï¸

- æ”¯æŒå¼€å‘å’Œç”Ÿäº§ç¯å¢ƒé…ç½®
- ç¯å¢ƒå˜é‡åŠ å¯†åŠŸèƒ½
- dotenvx é›†æˆ

2. **å®šæ—¶ä»»åŠ¡** â°

- ä½¿ç”¨ `@elysiajs/cron` å®ç°
- éªŒè¯ç æ¸…ç†ç­‰ç»´æŠ¤ä»»åŠ¡

3. **Docker æ”¯æŒ** ğŸ³

- å®Œæ•´çš„ Dockerfile é…ç½®
- å¤šå¹³å°æ„å»ºæ”¯æŒ

4. **ç»Ÿä¸€å“åº”æ ¼å¼** ğŸ“„

```typescript
interface ApiResponse<T> {
  success: boolean;
  data: T;
  message?: string;
  errorCode?: number;
}
```

## ğŸŒŸ æŠ€æœ¯æ ˆäº®ç‚¹

***

1. **ç°ä»£åŒ–è¿è¡Œæ—¶** âš¡

- ä½¿ç”¨ Bun ä½œä¸º JavaScript/TypeScript è¿è¡Œæ—¶
- é«˜æ€§èƒ½ç‰¹æ€§

2. **ç±»å‹å®‰å…¨** ğŸ›¡ï¸

- å®Œæ•´çš„ TypeScript æ”¯æŒ
- è‡ªå®šä¹‰ç±»å‹å®šä¹‰

3. **å¼€å‘ä½“éªŒ** ğŸ‘©â€ğŸ’»

- çƒ­é‡è½½æ”¯æŒ
- å®Œæ•´çš„å¼€å‘å·¥å…·é“¾
- ç»Ÿä¸€çš„ä»£ç é£æ ¼

4. **å®‰å…¨æ€§** ğŸ”

- JWT è®¤è¯
- éªŒè¯ç æœºåˆ¶
- ç¯å¢ƒå˜é‡åŠ å¯†
- æ”¯ä»˜ç­¾åéªŒè¯

è¿™æ˜¯ä¸€ä¸ªç»“æ„å®Œå–„çš„åç«¯é¡¹ç›®æ¡†æ¶ï¼Œé€‚åˆä½œä¸ºä¸­å°å‹é¡¹ç›®çš„èµ·ç‚¹ã€‚å®ƒæä¾›äº†å¸¸è§çš„åŸºç¡€è®¾æ–½å’Œæœ€ä½³å®è·µï¼ŒåŒæ—¶ä¿æŒäº†è‰¯å¥½çš„å¯æ‰©å±•æ€§ã€‚

## ğŸ“– ä½¿ç”¨è¯´æ˜

***

### ğŸ“¦ å®‰è£…ä¾èµ–

> æœ¬é¡¹ç›®ä½¿ç”¨ bun v1.1.21 é€šè¿‡ `bun init` åˆ›å»ºã€‚[Bun](https://bun.sh) æ˜¯ä¸€ä¸ªå¿«é€Ÿçš„å…¨èƒ½ JavaScript è¿è¡Œæ—¶ã€‚

```bash
bun install
```

### ğŸ”’ ç¯å¢ƒå˜é‡

***

é¡¹ç›®é‡‡ç”¨dotenvxç®¡ç†ç¯å¢ƒå˜é‡ï¼Œä½ åœ¨æ‹‰å–æ­¤é¡¹ç›®åï¼Œè¯·å…ˆä¿®æ”¹`.env.development`å’Œ`.env.production`æ–‡ä»¶ï¼Œæ·»åŠ ä½ çš„ç¯å¢ƒå˜é‡ã€‚

1. DATABASE_URLï¼š æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²ï¼Œè¯·æ ¹æ®ä½ çš„æ•°æ®åº“ç±»å‹ï¼Œä¿®æ”¹æ­¤å­—ç¬¦ä¸²ï¼Œä»–åœ¨`prisma/schema.prisma`ä¸­è¢«å¼•ç”¨ã€‚
2. SERVER_PORTï¼š æœåŠ¡ç«¯å£ï¼Œè¯·æ ¹æ®ä½ çš„éœ€è¦ï¼Œä¿®æ”¹æ­¤ç«¯å£ã€‚
3. EMAILï¼šå‘é€åŠŸèƒ½ä¾èµ–äºZeptoMailï¼Œè¯·å…ˆåœ¨ZeptoMailæ³¨å†Œè´¦å·ï¼Œå¹¶æ·»åŠ ä½ çš„API Tokenä»¥åŠå…¶ä»–ä¿¡æ¯ã€‚ä½ ä¹Ÿå¯ä»¥ç§»é™¤æ­¤æ¨¡å—ï¼Œä½¿ç”¨ä½ è‡ªå·±çš„é‚®ä»¶å‘é€æœåŠ¡ï¼Œæ–‡ä»¶ä½ç½®ï¼š`src/utils/email-sender.ts`ã€‚
4. æ”¯ä»˜ç›¸å…³é…ç½®ï¼š
   - LTZF_MCH_IDï¼šè“å…”æ”¯ä»˜å•†æˆ·ID
   - LTZF_MCH_SECRETï¼šè“å…”æ”¯ä»˜å•†æˆ·å¯†é’¥
   - LTZF_NOTIFY_URLï¼šæ”¯ä»˜é€šçŸ¥å›è°ƒåœ°å€
   - LTZF_QUIT_URLï¼šæ”¯ä»˜å–æ¶ˆå›è°ƒåœ°å€
   - LTZF_RETURN_URLï¼šæ”¯ä»˜å®Œæˆè¿”å›åœ°å€

### ğŸ”‘ åŠ å¯†å’Œè§£å¯†è¯´æ˜

***

æ³¨æ„ï¼šè¯·ä¸è¦å°†ç¯å¢ƒå˜é‡ä»¥æ˜æ–‡çš„å½¢å¼ä¸Šä¼ åˆ°å…¬å¼€ä»“åº“ï¼Œä½ å¯ä½¿ç”¨`bun run encrypt-dev/encrypt-prod`å‘½ä»¤ï¼ŒåŠ å¯†`.env.development/.env.production`æ–‡ä»¶ã€‚

å¦å¤–ï¼Œè¯·ä¸è¦å°†ç”Ÿæˆçš„`.env.keys`æ–‡ä»¶ä¸Šä¼ åˆ°å…¬å¼€ä»“åº“ï¼Œæ­¤æ–‡ä»¶åŒ…å«ä½ çš„åŠ å¯†ç§é’¥ï¼Œè¯·å¦¥å–„ä¿ç®¡ã€‚

[dotenvxæ–‡æ¡£](https://dotenvx.com/)

### ğŸ“ Git æäº¤ä»£ç æ ¼å¼åŒ–

***

è¿è¡Œä»¥ä¸‹å‘½ä»¤å®‰è£…husky

```bash
bun run prepare:fallback
```

### ğŸ˜ Prisma é…ç½®

***

è¯·å…ˆåœ¨`prisma/schema.prisma`ä¸­åˆ›å»ºmodelï¼Œå¦‚ä¸‹ï¼š

```prisma
model User {
  id    Int     @id @default(autoincrement())
  email String  @unique
  name  String?
}
```

ç°åœ¨ä½ è¿˜è¦ç•™æ„ç¯å¢ƒå˜é‡`DATABASE_URL`ï¼Œä»–éœ€è¦é…ç½®ä½ çš„æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²ï¼Œè¯·æ ¹æ®ä½ çš„æ•°æ®åº“ç±»å‹ï¼Œä¿®æ”¹æ­¤å­—ç¬¦ä¸²ã€‚

å½“ä½ æ¯æ¬¡é…ç½®å®Œ`schema.prisma`ï¼Œéƒ½è¦è¿è¡Œå‘½ä»¤`bun run migrate-[dev/depl]`ï¼Œä¸€ä¸ªæ˜¯å¼€å‘ç¯å¢ƒä¸€ä¸ªæ˜¯ç”Ÿäº§ç¯å¢ƒã€‚åœ¨è¿è¡Œåä»–ä¼šè‡ªåŠ¨æ‰§è¡Œ`bun run generate`è¿™æ ·å°±å¯ä»¥é€šè¿‡@prisma/clientè·å–åˆ°ç±»å‹æç¤ºä¿¡æ¯ã€‚

> å…³äºbinaryTargetsçš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è€ƒ[Prismaæ–‡æ¡£](https://www.prisma.io/docs/orm/overview/prisma-schema-file-structure/prisma-schema-file-structure#binarytargets)ã€‚

### â–¶ï¸ è¿è¡Œé¡¹ç›®

***

```bash
bun run dev
```

### ğŸ³ æ„å»º Docker é•œåƒ

***

æ„å»ºDockeré•œåƒï¼š

```bash
docker buildx build --push --platform linux/amd64 -t domain/project-name:latest .
```

è¿è¡Œé•œåƒï¼š

```bash
docker run -d -e DOTENV_PRIVATE_KEY_PRODUCTION="***" -v volume-name:/usr/src/app/media --restart unless-stopped --privileged -p 10010:7777 --name image-name  domain/project-name:latest
```
